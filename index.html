
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sen G√ºl√ºmsersen √ái√ßekler A√ßar</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap');

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            touch-action: none;
        }

        #message {
            position: absolute;
            top: 35%;
            width: 100%;
            text-align: center;
            color: #ffff00;
            font-family: 'Bebas Neue', cursive;
            font-size: 2, 2rem;
            text-shadow: 0 0 15px rgba(255, 255, 0, 1);
            z-index: 100;
            pointer-events: none;
        }
    </style>
</head>

<body onclick="if(video) video.elt.play()">

<div id="message">
Sen g√ºl√ºmsersen √ßi√ßekler a√ßar... <br>
Hadi g√ºl√ºmse :)
</div>

<script>

let video;
let isModelLoaded = false;
let isVideoReady = false;

let flowers = [];
const NUM_FLOWERS = 75;

let currentJoy = 0;
let targetJoy = 0;

const ANALYSIS_INTERVAL = 200;

async function setup() {
    createCanvas(windowWidth, windowHeight);
    colorMode(HSB, 360, 100, 100, 1);

    for (let i = 0; i < NUM_FLOWERS; i++) {
        flowers.push({
            x: random(width),
            y: random(height),
            maxSize: random(50, 95),
            hue: random(0, 360),
            offX: random(20000),
            offY: random(20000),
            noiseSpeed: random(0.0003, 0.0007)
        });
    }

    let constraints = {
        video: {
            facingMode: "user",
            width: { ideal: 640 },
            height: { ideal: 480 }
        }
    };

    video = createCapture(constraints, () => { 
        isVideoReady = true; 
        video.elt.setAttribute('playsinline', '');
    });
    video.size(640, 480);
    video.hide();

    const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/';
    await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
    await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);

    isModelLoaded = true;
    setInterval(analyzeFace, ANALYSIS_INTERVAL);
}

function draw() {
    background(0);

   // üé• TAM EKRAN COVER (Ger√ßek √ß√∂z√ºn√ºrl√ºkle)
if (isVideoReady && video.elt.videoWidth > 0) {

    push();

    translate(width, 0);
    scale(-1, 1);

    let vw = video.elt.videoWidth;
    let vh = video.elt.videoHeight;

    let canvasRatio = width / height;
    let videoRatio = vw / vh;

    let drawWidth, drawHeight;

    if (videoRatio > canvasRatio) {
        // Video daha geni≈ü ‚Üí yanlardan kƒ±rp
        drawHeight = height;
        drawWidth = height * videoRatio;
    } else {
        // Video daha uzun ‚Üí √ºst-alt kƒ±rp
        drawWidth = width;
        drawHeight = width / videoRatio;
    }

    image(video, 
        (width - drawWidth) / 2,
        (height - drawHeight) / 2,
        drawWidth,
        drawHeight
    );

    pop();
}


    fill(0, 0, 0, 0.75);
    rect(0, 0, width, height);

    currentJoy = lerp(currentJoy, targetJoy, 0.05);

    for (let f of flowers) {
        f.x += map(noise(f.offX), 0, 1, -0.6, 0.6);
        f.y += map(noise(f.offY), 0, 1, -0.6, 0.6);
        f.offX += f.noiseSpeed;
        f.offY += f.noiseSpeed;

        if (f.x < -100) f.x = width + 100;
        if (f.x > width + 100) f.x = -100;
        if (f.y < -100) f.y = height + 100;
        if (f.y > height + 100) f.y = -100;

        drawMorphingFlower(f.x, f.y, f.maxSize, f.hue, currentJoy);
    }
}

async function analyzeFace() {
    if (!isModelLoaded || !isVideoReady) return;
    const detections = await faceapi.detectAllFaces(video.elt, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();

    if (detections && detections.length > 0) {
        let joyValue = detections[0].expressions.happy;
        if (abs(joyValue - targetJoy) > 0.08) targetJoy = joyValue;
    } else {
        targetJoy = 0;
    }
}

function drawMorphingFlower(x, y, maxSize, h, joy) {
    push();
    translate(x, y);
    noStroke();

    let currentCenter = map(joy, 0, 1, 1, maxSize * 0.3);
    let brightness = map(joy, 0, 1, 40, 100);
    let alpha = 0.8;

    fill(h, 80, brightness, alpha);
    ellipse(0, 0, currentCenter, currentCenter);

    if (joy > 0.08) {
        let openDist = map(joy, 0.08, 1, 0, maxSize * 0.3);
        let petalW = map(joy, 0.08, 1, 0, maxSize * 0.5);
        let petalH = map(joy, 0.08, 1, 0, maxSize * 0.25);
        fill(h, 50, brightness, alpha * 0.7);
        for (let i = 0; i < 6; i++) {
            rotate(PI / 3);
            ellipse(openDist, 0, petalW, petalH);
        }
    }
    pop();
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
}

</script>
</body>
</html>
